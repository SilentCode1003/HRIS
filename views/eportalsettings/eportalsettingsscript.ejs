<script>
    let employeeid = '';
    $(document).ready(function () {
        console.log('Initialize');
        let employeeid = "<%= employeeid %>";
        loadAccount();

        function loadAccount() {
            $.ajax({
                type: "POST",
                url: `/eportalsettings/getsettingsaccount`,
                data: {
                    employeeid: employeeid,
                },
                success: function (result) {
                    if (result.msg === "success") {
                        const existingData = result.data;

                        $.each(existingData, (key, item) => {
                            $("#editpreview").attr(
                                "src",
                                "data:image/jpg;base64," + item.profilePicturePath
                            );
                            $("#editemployeefname").val(item.employeeid);
                            $("#inputUsername").val(item.username);
                            $("#inputFirstName").val(item.firstname);
                            $("#inputLastName").val(item.lastname);
                            $("#inputcivilstatus").val(item.civilstatus);
                            $("#inputjobstatus").val(item.jobstatus);
                            $("#inputEmail4").val(item.email);
                            $("#inputAddress").val(item.address);
                            base64String = item.profilePicturePath;
                        });
                    } else {
                        swal("Error fetching employee data", message, "error");
                    }
                },
                error: function (err) {
                    swal(
                        "An error occurred while fetching employee data",
                        message,
                        "error"
                    );
                },
            });
        };


        $(document).on("click", "#saveBtn", function () {
            const currentPassword = $('#inputPasswordCurrent').val();
            const newPassword = $('#inputPasswordNew').val();
            const confirmPassword = $('#inputPasswordNew2').val();

            // Validate that new password and confirm password match
            if (newPassword !== confirmPassword) {
                // Use SweetAlert for a nicer alert
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'New password and confirm password do not match',
                });
                return;
            }

            // Make an AJAX request
            $.ajax({
                type: 'POST',
                url: '/eportalsettings/updatepassword', // Replace with your actual update password route
                data: {
                    currentpass: currentPass,
                    newpass: newPass,
                },
                success: function (response) {
                    // Use SweetAlert for a success message
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: response.message,
                    });

                    // Optionally, redirect or perform additional actions after a successful update
                },
                error: function (error) {
                    console.error(error);
                    // Use SweetAlert for an error message
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Something went wrong!',
                    });
                },
            });
        });

    });

    $(document).on("change", "#editemployeeprofile", function (e) {
        const input = document.getElementById("editemployeeprofile");
        const file = input.files[0];

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onloadend = function () {
            const preview = document.getElementById("editpreview");
            preview.src = reader.result;
        };
        editimage();
    });

    function editimage() {
        const input = document.getElementById("editemployeeprofile");
        const file = input.files[0];

        var reader = new FileReader();
        console.log("next");

        reader.onload = function () {
            base64String = reader.result.replace("data:", "").replace(/^.+,/, "");

            imageBase64Stringsep = base64String;

            console.log(base64String);
        };
        reader.readAsDataURL(file);
    }
</script>