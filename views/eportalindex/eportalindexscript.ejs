<script>
    const OFFICE_LOCATION_LAT = 14.337945;
    const OFFICE_LOCATION_LNG = 121.060511;

    const map = L.map('map').setView([OFFICE_LOCATION_LAT, OFFICE_LOCATION_LNG], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Custom office icon
    const officeIcon = L.icon({
        iconUrl: './images/img/5L.png',  // Replace with the path to your office icon image
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32],
    });

    // Marker with custom icon
    const officeMarker = L.marker([OFFICE_LOCATION_LAT, OFFICE_LOCATION_LNG], { icon: officeIcon }).addTo(map);
    officeMarker.bindPopup('Office Location').openPopup();

    const geofence = L.circle([OFFICE_LOCATION_LAT, OFFICE_LOCATION_LNG], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.3,
        radius: 100
    }).addTo(map);

    function checkGeofence(userLocation) {
        const userLatLng = L.latLng(userLocation.lat, userLocation.lng);
        return userLatLng.distanceTo(geofence.getLatLng()) <= geofence.getRadius();
    }

    function updateLocationOnMap(position) {
        const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
        };

        // Clear previous markers
        map.eachLayer((layer) => {
            if (layer instanceof L.Marker) {
                layer.remove();
            }
        });

        const userMarker = L.marker([userLocation.lat, userLocation.lng]).addTo(map);
        userMarker.bindPopup(`My Location`).openPopup();
        const geofenceButton = document.getElementById('loginbtn');

        if (checkGeofence(userLocation)) {
            swal("Nasa office kana!", "You clicked the button!", "success");
            console.log('User is inside the geofence.');
            geofenceButton.style.display = 'block';
        } else {
            swal("wala kapa!", "You clicked the button!", "success");
            console.log('User is outside the geofence.');
            geofenceButton.style.display = 'none';
        }
    }

    function handleError(error) {
        console.error(`Error getting user location: ${error.message}`);
    }

    // Watch the device's position continuously
    const watchId = navigator.geolocation.watchPosition(updateLocationOnMap, handleError, {
        enableHighAccuracy: true,
        maximumAge: 30000,
        timeout: 27000
    });

</script>