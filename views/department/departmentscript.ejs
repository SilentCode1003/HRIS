<script>

  $(document).ready(function(){
    console.log('Initialize');
    LoadTable();

    function LoadTable() {
        $("#dataTabledepartment").DataTable({
          destroy: true,
          processing: true,
          serverSide: true,
          paging: false,
          searching: false,
          info: false,
          scrollY: 400,
          scrollCollapse: true,
          serverMethod: "GET",
          ajax: {
            url: "/department/load",
            dataSrc: (json) => {
              var finalData = [];
              var data = json.data;
  
              console.log(data);
              $.each(data, (key, item) => {
                var action = "";
                var status = item.status;

                action = `
                <button id="editBtn" class="btn btn-outline-danger fa fa-edit text-primary" name="editBtn" data-bs-toggle="modal" data-bs-target="#updateEventModal">Edit</button>
                <button id="editBtn" class="btn btn-outline-danger fa fa-edit text-primary" name="editBtn" data-toggle="modal" data-target="#cablingitempriceModal">Delete</button>
               `;
  
                finalData.push({
                  departmentid: item.departmentid,
                  departmentname: item.departmentname,
                  createdby: item.createdby,
                  createdate: item.createdate,
                  status: item.status,
                  action: action,
                });
              });
  
              return finalData;
            },
          },
          columnDefs: [
            {
              targets: 1,
              className: "td-indent",
            },
          ],
          columns: [
            { data: "departmentid" },
            { data: "departmentname" },
            { data: "createdby"},
            { data: "createdate" },
            { data: "status" },
            { data: "action" },
          ],
          initComplete: function () {
            console.log('Done');
          },
        });
      }
  
});

$(document).on("click", "#saveBtn", function () {
  let departmentname = $("#departmentname").val();
  let createdby = $("#departcreatedby").val();
  let createdate = $("departcreatedate").val();
  let status = $("#departstatus").val();

  var message = "";

  if (departmentname == "") {
    message += "TITTLE ";
  }

  if (createdby == "") {
    message += "DESCRIPTION ";
  }

  if (createdate == "") {
    message += "DESCRIPTION ";
  }

  if (status == "") {
    message += "POSITION NAME ";
  }

  if (message != "") {
  } else {

    $.ajax({
      type: "POST",
      url: "/department/save",
      data: {
        departmentname: departmentname,
        createdby: createdby,
        createdate: createdate,
        status: status,

      },
      success: function (result) {
        if (result.msg == "success") {
          swal({
            title: "Saved Successfully",
            text: "You clicked the button!",
            icon: "success",
            button: "OK!",
          })
          .then(results => {
          window.location.reload();
          })
          LoadTable();
        }
        else {
          swal({
            title: "Exist",
            text: "Data already exists!",
            icon: "warning",
            button: "OK!",
          });
        }
      
      },
      error: function (err) {
        swal("Data already exist!", "You clicked the button!", "warning");
      },
    });
  }

});



    // Get the modal
    var modal = document.getElementById("adddepartmentmodal");
    // Get the button that opens the modal
    var btn = document.getElementById("adddepartmentbtn");
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    // When the user clicks the button, open the modal 
    btn.onclick = function() {
      modal.style.display = "block";
    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
</script>
    