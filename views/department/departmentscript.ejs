<script>

  $(document).ready(function(){
    console.log('Initialize');
    LoadTable();

    function LoadTable() {
        $("#dataTabledepartment").DataTable({
          destroy: true,
          processing: true,
          serverSide: true,
          paging: false,
          searching: false,
          info: false,
          scrollY: 400,
          scrollCollapse: true,
          serverMethod: "GET",
          ajax: {
            url: "/department/load",
            dataSrc: (json) => {
              var finalData = [];
              var data = json.data;
  
              console.log(data);
              $.each(data, (key, item) => {
                var action = "";
                var status = item.status;

                action = `
                <button id="editBtn" class="btn text-primary" name="editBtn" data-bs-toggle="modal" data-bs-target="#editdepartmentmodal"><i class="fas fa-fw fa-pen"></i></button>
               `;
  
                finalData.push({
                  departmentid: item.departmentid,
                  departmentname: item.departmentname,
                  createdby: item.createdby,
                  createdate: item.createdate,
                  status: item.status,
                  action: action,
                });
              });
  
              return finalData;
            },
          },
          columnDefs: [
            {
              targets: 1,
              className: "td-indent",
            },
          ],
          columns: [
            { data: "departmentid" },
            { data: "departmentname" },
            { data: "createdby"},
            { data: "createdate" },
            { data: "status" },
            { data: "action" },
          ],
          initComplete: function () {
            console.log('Done');
          },
        });
      }
  
});

$(document).on("click", "#saveBtn", function () {
  let departmentname = $("#departmentname").val();
  let createdby = $("#departcreatedby").val();
  let createdate = $("departcreatedate").val();
  let status = $("#departstatus").val();

  var message = "";

  if (departmentname == "") {
    message += "TITTLE ";
  }

  if (createdby == "") {
    message += "DESCRIPTION ";
  }

  if (createdate == "") {
    message += "DESCRIPTION ";
  }

  if (status == "") {
    message += "POSITION NAME ";
  }

  if (message != "") {
  } else {

    $.ajax({
      type: "POST",
      url: "/department/save",
      data: {
        departmentname: departmentname,
        createdby: createdby,
        createdate: createdate,
        status: status,

      },
      success: function (result) {
        if (result.msg == "success") {
          swal({
            title: "Saved Successfully",
            text: "You clicked the button!",
            icon: "success",
            button: "OK!",
          })
          .then(results => {
          window.location.reload();
          })
          LoadTable();
        }
        else {
          swal({
            title: "Exist",
            text: "Data already exists!",
            icon: "warning",
            button: "OK!",
          });
        }
      
      },
      error: function (err) {
        swal("Data already exist!", "You clicked the button!", "warning");
      },
    });
  }

});



   //search bar
    
function searchTable() {
    var input, filter, found, table, tr, td, i, j;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("dataTabledepartment");
    tr = table.getElementsByTagName("tr");
    for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td");
        for (j = 0; j < td.length; j++) {
            if (td[j].innerHTML.toUpperCase().indexOf(filter) > -1) {
                found = true;
            }
        }
        if (found) {
            tr[i].style.display = "";
            found = false;
        } else {
            tr[i].style.display = "none";
        }
    }
}
</script>
    